<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Core -->
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <meta name="color-scheme" content="dark light"/>
  <title>Verify & Create Proof — TimeProofs</title>
  <meta name="description" content="Verify or create cryptographic proofs of existence. Hash locally, timestamp via API, verify publicly — private, instant, edge-native."/>
  <meta name="robots" content="index,follow"/>
  <meta name="theme-color" content="#0b1020"/>
  <meta name="referrer" content="strict-origin-when-cross-origin"/>
  <link rel="canonical" href="https://timeproofs.io/verify.html"/>

  <!-- Feeds & misc -->
  <link rel="alternate" type="application/yaml" href="/openapi.yaml"/>
  <link rel="author" href="/humans.txt"/>
  <link rel="status" href="https://status.timeproofs.io"/>

  <!-- Perf -->
  <link rel="preconnect" href="https://api.timeproofs.io" crossorigin>
  <link rel="dns-prefetch" href="//api.timeproofs.io">
  <link rel="preconnect" href="https://timeproofs-api.jeason-bacoul.workers.dev" crossorigin>
  <link rel="dns-prefetch" href="//timeproofs-api.jeason-bacoul.workers.dev">
  <link rel="preconnect" href="https://plausible.io" crossorigin>
  <link rel="preload" as="image" href="/logo%20(1).png" fetchpriority="high"/>

  <!-- Icons / Manifest -->
  <link rel="icon" href="/favicon.ico" sizes="any"/>
  <link rel="icon" href="/favicon.svg" type="image/svg+xml"/>
  <link rel="apple-touch-icon" href="/apple-touch-icon.png"/>
  <link rel="manifest" href="/site.webmanifest"/>

  <!-- Social -->
  <meta property="og:title" content="Verify & Create Proof — TimeProofs"/>
  <meta property="og:description" content="Hash locally. Timestamp instantly. Verify publicly. No blockchain, no friction."/>
  <meta property="og:type" content="website"/>
  <meta property="og:url" content="https://timeproofs.io/verify.html"/>
  <meta property="og:image" content="https://timeproofs.io/og.png"/>
  <meta property="og:site_name" content="TimeProofs"/>
  <meta property="og:locale" content="en_US"/>
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:title" content="Verify & Create Proof — TimeProofs"/>
  <meta name="twitter:description" content="Instant proof-of-existence for AI, data and every digital creation."/>
  <meta name="twitter:image" content="https://timeproofs.io/og.png"/>

  <!-- Security meta fallbacks -->
  <meta http-equiv="Permissions-Policy" content="camera=(), microphone=(), geolocation=(), interest-cohort=()">

  <!-- CSP v0.1 (SW + Analytics + API) -->
  <meta http-equiv="Content-Security-Policy" content="
default-src 'self' https://api.timeproofs.io https://timeproofs-api.jeason-bacoul.workers.dev;
worker-src 'self' blob:;
img-src 'self' data: https:;
style-src 'self' 'unsafe-inline';
script-src 'self' 'nonce-TP-2025' https://plausible.io https://static.cloudflareinsights.com;
connect-src 'self' https://api.timeproofs.io https://timeproofs-api.jeason-bacoul.workers.dev https://plausible.io;
font-src 'self' https: data:;
object-src 'none';
base-uri 'self';
form-action 'self';
frame-ancestors 'none';
upgrade-insecure-requests">

  <!-- Analytics (Plausible) -->
  <script defer data-domain="timeproofs.io" src="https://plausible.io/js/script.js" nonce="TP-2025"></script>

  <style>
    :root{
      --bg:#0b1020; --panel:#0f172a; --line:#1e293b;
      --text:#f8fafc; --muted:#94a3b8; --accent:#22d3ee;
      --ok:#22c55e; --bad:#ef4444;
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-btm: env(safe-area-inset-bottom, 0px);
      --safe-l: env(safe-area-inset-left, 0px);
      --safe-r: env(safe-area-inset-right, 0px);
      --header-h: 64px;
    }
    @media (max-width:900px){ :root{ --header-h: 56px } }

    *{ box-sizing:border-box }
    html,body{ height:100%; max-width:100%; background:var(--bg) }
    body{
      margin:0;
      background:
        radial-gradient(1000px 420px at 70% -10%, rgba(34,211,238,.10), transparent 60%),
        var(--bg);
      color:var(--text);
      font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      text-rendering:optimizeLegibility;
      padding-top: calc(var(--header-h) + var(--safe-top));
      padding-left: max(20px, var(--safe-l));
      padding-right: max(20px, var(--safe-r));
      overflow-x:hidden;
    }
    a{ color:var(--accent); text-decoration:none } a:hover{ text-decoration:underline }

    /* Header (identique au Home) */
    .tp-header{
      position:fixed; inset:0 0 auto 0; height:var(--header-h); z-index:1000;
      padding-top: var(--safe-top);
      padding-left: max(16px, var(--safe-l));
      padding-right: max(16px, var(--safe-r));
      background:rgba(11,16,32,.7); backdrop-filter:blur(8px);
      border-bottom:1px solid var(--line);
      display:flex; align-items:center; justify-content:space-between;
    }
    .tp-brand{ display:flex; align-items:center; gap:10px; color:var(--text); font-weight:900; letter-spacing:.2px; font-size:1.08rem }
    .tp-brand img{ height:40px; width:auto; object-fit:contain; vertical-align:middle }
    @media (max-width:899px){ .tp-brand img{ height:34px } }
    .tp-brand:hover{ color:var(--accent) }
    .tp-burger{ display:inline-flex; align-items:center; justify-content:center; width:42px; height:42px; border:1px solid var(--line); border-radius:10px; background:#0d1628; color:#f8fafc; cursor:pointer }
    .tp-nav a{ color:var(--text); font-weight:700; margin-left:18px; padding:8px 0; display:inline-block }
    .tp-nav a[aria-current="page"]{ color:#9beefb }
    .tp-nav a:hover{ color:var(--accent) }
    @media (min-width:900px){ .tp-burger{ display:none } .tp-nav{ display:flex; align-items:center } }
    @media (max-width:899px){
      .tp-nav{
        position:fixed;
        top:calc(var(--header-h) + var(--safe-top));
        left:0; right:0;
        background:#0c1424; border-top:1px solid var(--line);
        display:flex; flex-direction:column; gap:10px; padding:14px max(16px, var(--safe-r)) 14px max(16px, var(--safe-l));
        box-shadow:0 16px 40px rgba(0,0,0,.45);
        max-height: calc(100dvh - var(--header-h) - var(--safe-btm) - var(--safe-top));
        overflow:auto;
        transform:translateY(-10px); opacity:0; pointer-events:none; transition:opacity .18s ease, transform .18s ease;
      }
      .tp-nav a{ margin:4px 0 }
      .tp-nav[data-state="open"]{ transform:translateY(0); opacity:1; pointer-events:auto }
    }

    .wrap{ max-width:980px; margin:0 auto 40px; padding:0 }

    /* HERO uniforme */
    .tp-hero{ margin-top:14px; padding:18px 0 12px; border-bottom:1px solid var(--line); text-align:left }
    .tp-hero__icon{ font-size:1.6rem; line-height:1 }
    .tp-hero__kicker{ color:#9fb3c9; margin:.3rem 0 .2rem }
    .tp-hero__lead{ color:var(--muted); margin:.2rem 0 1rem; max-width:60ch }

    h1{ margin:.2rem 0 .4rem; font-size:clamp(1.7rem, 4.6vw, 2rem); font-weight:900 }

    .tabs{ display:flex; gap:8px; margin:14px 0 18px; flex-wrap:wrap }
    .tab{ padding:10px 14px; background:#0b1220; border:1px solid #1f2937; border-radius:10px; cursor:pointer; color:#cbd5e1 }
    .tab[aria-selected="true"]{ background:var(--panel); color:var(--text); border-color:#263244 }

    .grid{ display:grid; grid-template-columns:1fr; gap:16px }
    @media(min-width:860px){ .grid{ grid-template-columns:1fr 1fr } }

    .card{ background:#0c1424; border:1px solid var(--line); border-radius:14px; padding:18px }
    label{ display:block; font-size:13px; color:#a7b1c2; margin:8px 0 6px }
    input[type="text"], textarea{ width:100%; background:#0b1220; color:#f8fafc; border:1px solid #1f2937; border-radius:10px; padding:10px 12px }
    textarea{ min-height:110px; resize:vertical }
    .row{ display:flex; gap:12px; flex-wrap:wrap; align-items:center }
    .row > *{ flex:1 1 240px }
    .btn{ background:var(--accent); color:#06202a; border:none; padding:11px 16px; border-radius:10px; font-weight:800; cursor:pointer }
    .btn:hover{ filter:brightness(1.05) }
    .ghost{ background:#111d33; color:#e2f6ff; border:1px solid var(--line) }

    .hint{ font-size:12px; color:#93a1b5 }
    .pill{ display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; font-size:12px; margin-left:8px }
    .ok{ background:#0f3b22; color:#b7f7ce; border:1px solid #1c6b3d }
    .bad{ background:#3b0f12; color:#ffc1c6; border:1px solid #6b1c22 }

    pre{
      width:100%;
      background:#0b1220; color:#a7f3d0; border:1px solid #1f2937; border-radius:10px; padding:12px;
      white-space:pre-wrap; word-break:break-all; overflow-wrap:anywhere; font-size:13px;
      max-height:40vh; overflow:auto;
    }
    .actions{ display:flex; gap:8px; margin-top:10px; flex-wrap:wrap }

    .drop{ margin-top:10px; padding:14px; border:1px dashed #2b3b55; border-radius:10px; background:#0b1220; color:#cfe3f5; text-align:center; font-size:.92rem }
    .drop.drag{ border-color:#22d3ee; background:#0f1f33 }

    footer{ border-top:1px solid var(--line); margin-top:44px; padding:18px; color:#7c8aa5; text-align:center }
    footer .badges{ display:flex; gap:8px; justify-content:center; margin:10px 0 }
    footer .badge{ display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border:1px solid var(--line); border-radius:999px; background:#0d1628; font-size:.9rem; color:#cfefff }
    .social{ display:flex; gap:10px; justify-content:center; margin-top:10px }
    .social a{
      display:inline-flex; width:40px; height:40px; border:1px solid var(--line); border-radius:12px;
      align-items:center; justify-content:center; background:#0d1628; transition:transform .18s ease; color:#cfefff
    }
    .social a:hover{ transform:translateY(-2px) }

    /* Mobile touch targets */
    @media (max-width:480px){
      .card{ padding:14px }
      .row{ gap:8px }
      .btn, .row .btn{ width:100%; min-height:44px }
      .tab{ padding:8px 10px; font-size:.95rem }
      input[type="text"], textarea{ padding:9px 10px; font-size:14px }
    }
  </style>

  <noscript><style>.reveal{opacity:1 !important; transform:none !important}</style></noscript>
</head>
<body>
  <!-- Header -->
  <header class="tp-header" role="banner">
    <a class="tp-brand" href="/" aria-label="TimeProofs Home">
      <img src="/logo%20(1).png" alt="TimeProofs logo" fetchpriority="high" decoding="async"/>
      <span>TimeProofs</span>
    </a>
    <button class="tp-burger" id="tp-burger" aria-label="Open menu" aria-expanded="false" aria-controls="tp-nav"><span aria-hidden="true">☰</span></button>
    <nav id="tp-nav" class="tp-nav" data-state="closed" aria-label="Main Navigation">
      <a href="/proofspec.html">Protocol (ProofSpec)</a>
      <a href="/use-cases.html">Use Cases</a>
      <a href="/verify.html" aria-current="page">Create/Verify</a>
      <a href="/docs.html">API Docs</a>
      <a href="/regulations.html">Regulations</a>
      <a href="/security.html">Security</a>
      <a href="/privacy.html">Privacy</a>
      <a href="/legal.html">Legal</a>
    </nav>
  </header>

  <main class="wrap" id="main" role="main">
    <!-- HERO unifié -->
    <section class="tp-hero" role="region" aria-labelledby="page-title">
      <div class="tp-hero__icon" aria-hidden="true">🔐</div>
      <p class="tp-hero__kicker">Status: <strong>Public Beta v0.1</strong> · Verify & Create · Privacy-first · No blockchain</p>
      <h1 id="page-title">Verify & Create Proof</h1>
      <p class="tp-hero__lead">Hash locally → timestamp & sign via API → verify publicly. Your content never leaves your device. <strong>Max file: 50&nbsp;MB</strong>.</p>
    </section>

    <div class="tabs" role="tablist" aria-label="Create or Verify">
      <button id="tab-create" class="tab" role="tab" aria-selected="true" aria-controls="panel-create">Create Proof</button>
      <button id="tab-verify" class="tab" role="tab" aria-selected="false" aria-controls="panel-verify">Verify Proof</button>
    </div>

    <div class="grid">
      <!-- CREATE -->
      <section class="card" id="panel-create" role="tabpanel" aria-labelledby="tab-create" aria-busy="false">
        <label>Choose input</label>
        <div class="row" role="group" aria-label="Input mode">
          <button class="btn ghost" id="choose-text" type="button">Text</button>
          <button class="btn ghost" id="choose-file" type="button">File</button>
          <button class="btn ghost" id="choose-hash" type="button">Raw hash</button>
        </div>

        <div id="input-text" style="margin-top:14px;">
          <label for="text">Text to hash (SHA-256 runs locally)</label>
          <textarea id="text" placeholder="Paste or type your text here..." spellcheck="false" enterkeyhint="done"></textarea>
          <div id="hash-preview-text" class="hint" aria-live="polite"></div>
        </div>

        <div id="input-file" style="display:none; margin-top:14px;">
          <label for="file">File to hash (processed locally)</label>
          <input type="file" id="file" aria-describedby="file-hint"/>
          <p id="file-hint" class="hint">We only compute a hash in your browser. The file is never uploaded. <strong>Max 50 MB.</strong></p>
          <div id="drop" class="drop">…or drag & drop a file here</div>
          <div id="file-info" class="hint" aria-live="polite"></div>
          <div id="hash-preview-file" class="hint" aria-live="polite"></div>
        </div>

        <div id="input-hash" style="display:none; margin-top:14px;">
          <label for="raw-hash">Existing SHA-256 hash (hex)</label>
          <input type="text" id="raw-hash" placeholder="e3b0c44298fc1c149a..." inputmode="latin" autocapitalize="off" autocomplete="off" spellcheck="false" pattern="[A-Fa-f0-9]{64}" enterkeyhint="done"/>
          <p class="hint">64 hex characters, case-insensitive.</p>
          <div id="hash-preview-raw" class="hint" aria-live="polite"></div>
        </div>

        <div class="row" style="margin-top:16px;">
          <div>
            <label for="type">Type (optional)</label>
            <input type="text" id="type" placeholder="prompt | gen | file | webhook | other" autocomplete="off" maxlength="32"/>
          </div>
          <div>
            <label for="meta">Meta (optional JSON, small)</label>
            <input type="text" id="meta" placeholder='{"model":"gpt-4o","mime":"text/plain"}' autocomplete="off" spellcheck="false" maxlength="1024"/>
          </div>
        </div>

        <div class="row" style="margin-top:16px;">
          <button class="btn" id="btn-create" type="button" aria-controls="create-output create-status">Create Proof</button>
          <span class="hint">Outputs: hash, timestamp, signature, verify URL</span>
        </div>

        <div id="create-status" style="margin-top:12px;" aria-live="polite"></div>
        <pre id="create-output" style="margin-top:12px;" aria-live="polite"></pre>
        <div class="actions" id="create-actions" style="display:none;">
          <a class="btn ghost" id="open-verify-link" href="#" target="_blank" rel="noopener noreferrer" style="display:none">Open verify link</a>
          <button class="btn ghost" id="copy-create-json" type="button" disabled>Copy JSON</button>
          <button class="btn ghost" id="copy-create-curl" type="button" disabled>Copy cURL</button>
        </div>
      </section>

      <!-- VERIFY -->
      <section class="card" id="panel-verify" role="tabpanel" aria-labelledby="tab-verify" aria-busy="false" style="display:none;">
        <label for="verify-hash">Hash to verify (SHA-256, hex)</label>
        <input type="text" id="verify-hash" placeholder="Paste an existing hash" inputmode="latin" autocapitalize="off" autocomplete="off" spellcheck="false" pattern="[A-Fa-f0-9]{64}" enterkeyhint="go"/>
        <div class="row" style="margin-top:12px;">
          <button class="btn" id="btn-verify" type="button" aria-controls="verify-output verify-status">Verify</button>
          <span class="hint">Checks existence, timestamp, and server signature.</span>
        </div>
        <div id="verify-status" style="margin-top:12px;" aria-live="polite"></div>
        <pre id="verify-output" style="margin-top:12px;" aria-live="polite"></pre>
        <div class="actions" id="verify-actions" style="display:none;">
          <button class="btn ghost" id="copy-verify-json" type="button" disabled>Copy JSON</button>
          <button class="btn ghost" id="copy-verify-curl" type="button" disabled>Copy cURL</button>
        </div>
      </section>
    </div>
  </main>

  <!-- Footer -->
  <footer role="contentinfo" aria-label="Site footer">
    <div class="badges">
      <span class="badge">⚡ Edge Native</span>
      <span class="badge">🛡 Privacy First</span>
      <a class="badge" href="/proofspec.html">🔍 Open Spec v0.1</a>
    </div>
    © 2025 TimeProofs — Reference implementation of the ProofSpec protocol.
    <div class="links" style="margin-top:6px">
      <a href="/">Home</a> •
      <a href="/proofspec.html">Protocol</a> •
      <a href="/use-cases.html">Use Cases</a> •
      <a href="/verify.html" aria-current="page">Create/Verify</a> •
      <a href="/docs.html">API Docs</a> •
      <a href="/regulations.html">Regulations</a> •
      <a href="/.well-known/security.txt">Security.txt</a> •
      <a href="/privacy.html">Privacy</a> •
      <a href="/legal.html">Legal</a> •
      <a href="/humans.txt">humans.txt</a>
    </div>
    <div class="social" aria-label="Social links">
      <a href="https://x.com/timeproofs" target="_blank" rel="noopener" aria-label="Follow @timeproofs on X">
        <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M18.9 3H22l-9.6 10.9L21.6 21h-6.7l-5.3-6.6L3.6 21H2l10.2-11.6L2.8 3h6.7l4.8 6 4.6-6Z"/></svg>
      </a>
      <a href="https://github.com/BACOUL/timeproofs/tree/timeproofsv2" target="_blank" rel="noopener" aria-label="TimeProofs on GitHub">
        <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M12 .5A11.5 11.5 0 0 0 .5 12a11.5 11.5 0 0 0 7.9 10.9c.6.1.8-.3.8-.6v-2.1c-3.2.7-3.9-1.4-3.9-1.4-.6-1.4-1.4-1.7-1.4-1.7-1.1-.7.1-.7.1-.7 1.2.1 1.8 1.2 1.8 1.2 1.1 1.8 2.8 1.3 3.5 1 .1-.8.4-1.3.7-1.6-2.6-.3-5.4-1.3-5.4-6 0-1.3.5-2.3 1.2-3.2-.1-.3-.5-1.6.1-3.2 0 0 1-.3 3.3 1.2a11.5 11.5 0 0 1 6 0C16.9 4.9 18 5.2 18 5.2c.6 1.6.2 2.9.1 3.2.8.9 1.2 1.9 1.2 3.2 0 4.7-2.8 5.7-5.4 6 .4.3.8 1 .8 2.1v3.1c0 .3.2.7.8.6A11.5 11.5 0 0 0 23.5 12 11.5 11.5 0 0 0 12 .5Z"/></svg>
      </a>
      <a href="https://www.linkedin.com/company/timeproofs" target="_blank" rel="noopener" aria-label="TimeProofs on LinkedIn">
        <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M4.98 3.5A2.5 2.5 0 1 1 5 8.5a2.5 2.5 0 0 1-.02-5ZM3 9h4v12H3V9Zm7 0h3.8v1.7h.1c.5-.9 1.8-1.8 3.7-1.8 4 0 4.7 2.6 4.7 6v6.1h-4V15c0-1.4 0-3.2-2-3.2s-2.3 1.5-2.3 3.1V21H10V9Z"/></svg>
      </a>
      <a href="https://youtube.com/@timeproofs" target="_blank" rel="noopener" aria-label="TimeProofs on YouTube">
        <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M23 7.5s-.2-1.6-.8-2.3c-.8-.8-1.7-.8-2.1-.9C16.8 4 12 4 12 4h0s-4.8 0-8.1.3c-.4 0-1.3 0-2.1.9C1.2 5.9 1 7.5 1 7.5S.8 9.3.8 11v2c0 1.7.2 3.5.2 3.5s.2 1.6.8 2.3c.8.8 1.9.8 2.4.9C6.2 19.9 12 20 12 20s4.8 0 8.1-.3c.4 0 1.3 0 2.1-.9.6-.7.8-2.3.8-2.3s.2-1.8.2-3.5v-2c0-1.7-.2-3.5-.2-3.5ZM9.8 15.5v-7l6.2 3.5-6.2 3.5Z"/></svg>
      </a>
      <a href="/rss.xml" target="_blank" rel="noopener" aria-label="TimeProofs RSS">
        <svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true"><path fill="currentColor" d="M6 18a2 2 0 1 1 0 4 2 2 0 0 1 0-4Zm-2-7a13 13 0 0 1 13 13h-3A10 10 0 0 0 4 14v-3Zm0-6a19 19 0 0 1 19 19h-3A16 16 0 0 0 4 5V2Z"/></svg>
      </a>
    </div>
  </footer>

  <!-- Header burger -->
  <script defer nonce="TP-2025">
  document.addEventListener('DOMContentLoaded', function(){
    const burger = document.getElementById('tp-burger');
    const nav = document.getElementById('tp-nav');
    if(!burger || !nav) return;

    function openMenu(){ nav.setAttribute('data-state','open'); burger.setAttribute('aria-expanded','true'); document.documentElement.style.overflow='hidden'; }
    function closeMenu(){ nav.setAttribute('data-state','closed'); burger.setAttribute('aria-expanded','false'); document.documentElement.style.overflow=''; }
    function toggleMenu(){ (nav.getAttribute('data-state')==='open') ? closeMenu() : openMenu(); }

    burger.addEventListener('click', toggleMenu, { passive:true });
    document.addEventListener('click', (e)=>{ if (window.matchMedia('(min-width: 900px)').matches) return; if (!e.target.closest('.tp-header') && nav.getAttribute('data-state')==='open') closeMenu(); }, { passive:true });
    document.addEventListener('keydown', (e)=>{ if (e.key==='Escape' && nav.getAttribute('data-state')==='open') closeMenu(); }, { passive:true });
    window.addEventListener('resize', ()=>{ if (window.matchMedia('(min-width: 900px)').matches) closeMenu(); }, { passive:true });
  });
  </script>

  <!-- Prevent full-page drop -->
  <script defer nonce="TP-2025">
    (function(){
      ['dragover','drop'].forEach(type=>{
        document.addEventListener(type, e=>{
          if (!e.target || !(e.target.closest && e.target.closest('#drop'))) { e.preventDefault(); e.stopPropagation(); }
        });
      });
    })();
  </script>

  <!-- App Scripts -->
  <script defer nonce="TP-2025">
    const API_BASES = [
      "https://api.timeproofs.io/api",
      "https://timeproofs-api.jeason-bacoul.workers.dev/api"
    ];
    const MAX_FILE_BYTES = 50 * 1024 * 1024;
    const REQ_TIMEOUT_MS = 15000;

    const panelCreate = document.getElementById('panel-create');
    const panelVerify = document.getElementById('panel-verify');

    // Tabs switching (fix: manquait)
    (function tabs(){
      const tCreate = document.getElementById('tab-create');
      const tVerify = document.getElementById('tab-verify');
      function act(which){
        const isCreate = which==='create';
        tCreate.setAttribute('aria-selected', isCreate?'true':'false');
        tVerify.setAttribute('aria-selected', isCreate?'false':'true');
        panelCreate.style.display = isCreate?'block':'none';
        panelVerify.style.display = isCreate?'none':'block';
      }
      tCreate.addEventListener('click', ()=>act('create'));
      tVerify.addEventListener('click', ()=>act('verify'));
      act('create');
    })();

    function withTimeout(options={}){
      const ctrl = new AbortController();
      const t = setTimeout(()=>ctrl.abort(), REQ_TIMEOUT_MS);
      return { ...options, signal: ctrl.signal, _timeoutId: t };
    }
    async function fetchAPI(path, options={}){
      let lastErr, res;
      for (const base of API_BASES){
        try{
          const opt = withTimeout(options);
          res = await fetch(`${base}${path}`, opt);
          clearTimeout(opt._timeoutId);
          if (res.ok || res.status < 500) return res;
        }catch(e){ lastErr = e; }
      }
      if (res) return res;
      throw lastErr || new Error("Network error");
    }

    async function sha256HexFromText(str){
      const enc = new TextEncoder().encode(str || '');
      const buf = await crypto.subtle.digest('SHA-256', enc);
      return [...new Uint8Array(buf)].map(b=>b.toString(16).padStart(2,'0')).join('');
    }
    async function sha256HexFromFile(file){
      const buf = await file.arrayBuffer();
      const digest = await crypto.subtle.digest('SHA-256', buf);
      return [...new Uint8Array(digest)].map(b=>b.toString(16).padStart(2,'0')).join('');
    }

    // Input mode toggles
    const chooseText = document.getElementById('choose-text');
    const chooseFile = document.getElementById('choose-file');
    const chooseHash = document.getElementById('choose-hash');
    const inputText = document.getElementById('input-text');
    const inputFile = document.getElementById('input-file');
    const inputHash = document.getElementById('input-hash');
    chooseText.onclick = ()=>{ inputText.style.display='block'; inputFile.style.display='none'; inputHash.style.display='none'; };
    chooseFile.onclick = ()=>{ inputText.style.display='none'; inputFile.style.display='block'; inputHash.style.display='none'; };
    chooseHash.onclick = ()=>{ inputText.style.display='none'; inputFile.style.display='none'; inputHash.style.display='block'; };

    // Live previews
    const textArea = document.getElementById('text');
    const hashPrevText = document.getElementById('hash-preview-text');
    const hashPrevFile = document.getElementById('hash-preview-file');
    const hashPrevRaw  = document.getElementById('hash-preview-raw');

    let textHashDebounce;
    textArea?.addEventListener('input', ()=>{
      clearTimeout(textHashDebounce);
      textHashDebounce = setTimeout(async ()=>{
        const v = textArea.value || '';
        if (!v) { hashPrevText.textContent = ''; return; }
        const h = await sha256HexFromText(v);
        hashPrevText.textContent = `SHA-256: ${h}`;
      }, 200);
    });

    const drop = document.getElementById('drop');
    const fileInput = document.getElementById('file');
    const fileInfo = document.getElementById('file-info');

    function setFileInfo(f){
      if (!f) { fileInfo.textContent=''; hashPrevFile.textContent=''; return; }
      const sizeMB = (f.size/1024/1024).toFixed(2);
      fileInfo.textContent = `${f.name} (${sizeMB} MB)`;
    }
    if (drop){
      ['dragenter','dragover'].forEach(ev => drop.addEventListener(ev, e => { e.preventDefault(); e.stopPropagation(); drop.classList.add('drag'); }));
      ['dragleave','drop'].forEach(ev => drop.addEventListener(ev, e => { e.preventDefault(); e.stopPropagation(); drop.classList.remove('drag'); }));
      drop.addEventListener('drop', async e => {
        const f = e.dataTransfer?.files?.[0];
        if (!f) return;
        if (f.size > MAX_FILE_BYTES) { alert('File too large (max 50 MB).'); return; }
        fileInput.files = e.dataTransfer.files;
        setFileInfo(f);
        const h = await sha256HexFromFile(f);
        hashPrevFile.textContent = `SHA-256: ${h}`;
      });
      fileInput.addEventListener('change', async ()=>{
        const f = fileInput.files?.[0];
        if (!f) { setFileInfo(null); return; }
        if (f.size > MAX_FILE_BYTES) { setFileInfo(null); fileInput.value=''; alert('File too large (max 50 MB).'); return; }
        setFileInfo(f);
        const h = await sha256HexFromFile(f);
        hashPrevFile.textContent = `SHA-256: ${h}`;
      });
    }

    const rawHashEl = document.getElementById('raw-hash');
    rawHashEl?.addEventListener('input', ()=>{
      const v = (rawHashEl.value || '').trim();
      hashPrevRaw.textContent = v ? `Hash: ${v}` : '';
    });

    function fail(msg){ throw new Error(msg); }
    function setBusy(el, busy){ el?.setAttribute('aria-busy', busy ? 'true' : 'false'); }

    // Create
    const btnCreate = document.getElementById('btn-create');
    const outCreate = document.getElementById('create-output');
    const statusCreate = document.getElementById('create-status');
    const createActions = document.getElementById('create-actions');
    const openVerifyLink = document.getElementById('open-verify-link');
    const copyCreateJSON = document.getElementById('copy-create-json');
    const copyCreateCURL = document.getElementById('copy-create-curl');

    function copyToClipboard(text){
      navigator.clipboard?.writeText(text).then(()=>alert('Copied to clipboard'))
      .catch(()=>prompt('Copy manually:', text));
    }

    function enableCreateActions(data, req){
      createActions.style.display='flex';
      copyCreateJSON.disabled=false; copyCreateCURL.disabled=false;
      const vurl = data?.verify_url;
      if (vurl){ openVerifyLink.style.display='inline-block'; openVerifyLink.href=vurl; }
      else if (data?.hash){ openVerifyLink.style.display='inline-block'; openVerifyLink.href=`/verify.html?hash=${encodeURIComponent(data.hash)}`; }
      else openVerifyLink.style.display='none';

      copyCreateJSON.onclick = () => copyToClipboard(outCreate.textContent);
      copyCreateCURL.onclick = () => {
        const curlBody = JSON.stringify(req).replace(/'/g, "'\\''");
        copyToClipboard(`curl -sS -X POST 'https://api.timeproofs.io/api/timestamp' -H 'Content-Type: application/json' -d '${curlBody}'`);
      };
    }

    btnCreate.onclick = async ()=>{
      if (btnCreate.disabled) return;
      btnCreate.disabled=true; setBusy(panelCreate,true);
      outCreate.textContent=''; statusCreate.innerHTML=''; createActions.style.display='none'; openVerifyLink.style.display='none'; copyCreateJSON.disabled=true; copyCreateCURL.disabled=true;

      try{
        let hash='';
        if (inputText.style.display!=='none'){
          const text = textArea.value || '';
          if (!text) fail('Enter some text to hash.');
          hash = await sha256HexFromText(text);
        } else if (inputFile.style.display!=='none'){
          const file = fileInput.files?.[0];
          if (!file) fail('Select a file first.');
          if (file.size > MAX_FILE_BYTES) fail('File too large (max 50 MB).');
          hash = await sha256HexFromFile(file);
        } else {
          hash = (rawHashEl.value||'').trim();
          if (!/^[a-f0-9]{64}$/i.test(hash)) fail('Enter a valid 64-hex SHA-256 hash.');
          hash = hash.toLowerCase();
        }

        const type = (document.getElementById('type').value || 'event').trim();
        if (type.length > 32) fail('Type too long (max 32 chars).');

        let meta = {};
        const metaRaw = (document.getElementById('meta').value || '').trim();
        if (metaRaw){
          if (metaRaw.length > 1024) fail('Meta JSON too large (max 1 KB).');
          try{ meta = JSON.parse(metaRaw); }catch{ fail('Meta must be valid JSON.'); }
        }

        const req = { hash, type, meta };
        const r = await fetchAPI(`/timestamp`, { method:'POST', headers:{ 'Content-Type':'application/json' }, body: JSON.stringify(req) });
        const j = await r.json().catch(()=> ({}));
        if (!r.ok || j.error) fail(j.error || `Request failed (${r.status})`);

        const normalized = {
          ok: j.ok === true,
          hash: j.hash,
          timestamp: j.timestamp || j.ts,
          signature: j.signature || j.sig,
          verify_url: j.verify_url || (j.hash ? `/verify.html?hash=${encodeURIComponent(j.hash)}` : undefined),
          type: j.type, meta: j.meta
        };

        statusCreate.innerHTML = `<span class="pill ok" role="status">✅ Proof created</span>`;
        outCreate.textContent = JSON.stringify(normalized, null, 2);
        enableCreateActions(normalized, req);
      }catch(e){
        statusCreate.innerHTML = `<span class="pill bad" role="alert">❌ ${String(e.message || e)}</span>`;
      }finally{
        btnCreate.disabled=false; setBusy(panelCreate,false);
      }
    };

    // Verify
    const btnVerify = document.getElementById('btn-verify');
    const outVerify = document.getElementById('verify-output');
    const statusVerify = document.getElementById('verify-status');
    const verifyActions = document.getElementById('verify-actions');
    const copyVerifyJSON = document.getElementById('copy-verify-json');
    const copyVerifyCURL = document.getElementById('copy-verify-curl');

    // Support ?hash=... auto-verify
    const params = new URLSearchParams(location.search);
    const preHash = params.get('hash');
    if (preHash && /^[a-f0-9]{64}$/i.test(preHash)) {
      document.getElementById('verify-hash').value = preHash;
      document.getElementById('tab-verify').click();
      setTimeout(()=>btnVerify.click(), 60);
    }

    btnVerify.onclick = async ()=>{
      if (btnVerify.disabled) return;
      btnVerify.disabled=true; setBusy(panelVerify,true);
      outVerify.textContent=''; statusVerify.innerHTML=''; verifyActions.style.display='none'; copyVerifyJSON.disabled=true; copyVerifyCURL.disabled=true;

      try{
        const hash = (document.getElementById('verify-hash').value || '').trim().toLowerCase();
        if (!/^[a-f0-9]{64}$/i.test(hash)) fail('Paste a valid 64-hex SHA-256 hash.');

        // Try GET first
        let r = await fetchAPI(`/verify?hash=${encodeURIComponent(hash)}`);
        let j = await r.json().catch(()=> ({}));

        // Fallback: POST /verify if GET doesn't return a decisive result
        const decisive = (resp)=> (resp.ok===true) || resp.valid===true || resp.found===true || !!(resp.timestamp||resp.ts||resp.signature||resp.sig);
        if (!decisive(j)) {
          try{
            r = await fetchAPI(`/verify`, { method:'POST', headers:{ 'Content-Type':'application/json' }, body: JSON.stringify({ hash }) });
            j = await r.json().catch(()=> ({}));
          }catch(_e){}
        }

        const okFlag = (j.ok===true) || (j.valid===true);
        const found = (j.found===true) || okFlag || !!(j.timestamp||j.ts||j.signature||j.sig);

        if (okFlag && found) statusVerify.innerHTML = `<span class="pill ok" role="status">✅ Valid</span>`;
        else if (j.error === 'not_found' || r.status === 404) statusVerify.innerHTML = `<span class="pill bad" role="status">❌ Not found</span>`;
        else statusVerify.innerHTML = `<span class="pill bad" role="status">❌ Invalid</span>`;

        const normalized = {
          ok: !!okFlag, found: !!found,
          hash: j.hash || hash,
          timestamp: j.timestamp || j.ts || null,
          signature: j.signature || j.sig || null,
          type: j.type || null, meta: j.meta || null
        };
        outVerify.textContent = JSON.stringify(normalized, null, 2);

        verifyActions.style.display='flex';
        copyVerifyJSON.disabled=false; copyVerifyCURL.disabled=false;
        copyVerifyJSON.onclick = () => copyToClipboard(outVerify.textContent);
        copyVerifyCURL.onclick = () => copyToClipboard(`curl -sS 'https://api.timeproofs.io/api/verify?hash=${encodeURIComponent(hash)}'`);
      }catch(e){
        statusVerify.innerHTML = `<span class="pill bad" role="alert">❌ ${String(e.message || e)}</span>`;
      }finally{
        btnVerify.disabled=false; setBusy(panelVerify,false);
      }
    };
  </script>

  <!-- Register Service Worker v0.1 -->
  <script nonce="TP-2025">
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js', { type: 'module', scope: '/' }).catch(()=>{});
    }
  </script>
</body>
  </html>
